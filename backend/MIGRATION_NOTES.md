# Миграция проекта на новую структуру

## Что было сделано

### 1. База данных
Созданы новые модели согласно ERD диаграмме:
- `University` (ВУЗ)
- `User` (Пользователь) - обновлена структура
- `Staff` (Сотрудник деканата/ректората)
- `Faculty` (Факультет)
- `Kafedra` (Кафедра)
- `StudentGroup` (Учебная группа)
- `Student` (Студент)
- `Teacher` (Преподаватель)
- `Room` (Аудитория)
- `Subject` (Предмет)
- `Timeslot` (Временные слоты)
- `Lesson` (Занятие)
- `LessonGroup` (Связь многие-ко-многим между Lesson и StudentGroup)
- `ScheduleMeta` (Метаданные расписания)
- `ScheduleChangelog` (Журнал изменений расписания)
- `Request` (Запрос)
- `ApprovalRoad` (Путь согласования)

Все модели используют GUID для UUID полей (совместимо с SQLite).

### 2. Модуль 1: Верификация пользователя
**Эндпоинт:** `POST /api/v1/module1/verify`

Реализована логика верификации пользователя:
- Пользователь выбирает роль и вводит данные
- Система проверяет существование студента/преподавателя/сотрудника в базе деканата
- Если найден: успех, привязываем max_id к уже созданному пользователю
- Если не найден: ошибка, пользователь должен обратиться в деканат

**Схема запроса:** `UserVerificationRequest`
**Схема ответа:** `UserVerificationResponse`

### 3. Модуль 2: Управление пользователями и расписанием

#### 3.1. Добавление студентов
**Эндпоинт:** `POST /api/v1/module2/students/add`

Создает нового студента в системе. Используется сотрудником ВУЗа.

#### 3.2. Добавление преподавателей
**Эндпоинт:** `POST /api/v1/module2/teachers/add`

Создает нового преподавателя в системе. Используется сотрудником ВУЗа.

#### 3.3. Получение расписания
**Эндпоинт:** `GET /api/v1/module2/schedule`

Получает расписание для группы или преподавателя.
Расписание создается пустым при добавлении факультета, дальше только патчи.

#### 3.4. Применение патчей к расписанию
**Эндпоинт:** `PATCH /api/v1/module2/schedule/patch`

Применяет изменения (патчи) к расписанию:
- Создает записи в Schedule changelog
- Обновляет версию расписания
- В будущем: отправляет уведомления пользователям, связанным с изменением

**Поддерживаемые действия:**
- `create` - создание нового занятия
- `update` - обновление существующего занятия
- `delete` - удаление занятия

#### 3.5. Журнал изменений расписания
**Эндпоинт:** `GET /api/v1/module2/schedule/changelog`

Получает журнал изменений расписания для группы или преподавателя.

### 4. Схемы (Schemas)
Созданы Pydantic схемы для всех новых моделей:
- `university.py`
- `user.py` (обновлена)
- `student.py`
- `teacher.py`
- `schedule.py`
- `faculty.py`
- `student_group.py`

### 5. Сервисы
Созданы сервисы для работы с новыми моделями:
- `user_service.py` - работа с пользователями и верификация
- `student_service.py` - работа со студентами
- `teacher_service.py` - работа с преподавателями
- `schedule_service.py` - работа с расписанием

### 6. Обновления
- Обновлен `main.py` - изменено описание проекта
- Обновлен `router.py` - добавлены новые endpoints
- Обновлен `config.py` - изменено название проекта
- Создан тип `GUID` в `db/types.py` для совместимости UUID с SQLite

## Структура API

### Верификация пользователя
- `POST /api/v1/auth/verify` - верификация пользователя

### Управление пользователями и расписанием
- `POST /api/v1/students/add` - добавление студента
- `POST /api/v1/teachers/add` - добавление преподавателя
- `GET /api/v1/schedule` - получение расписания
- `PATCH /api/v1/schedule/patch` - применение патчей
- `GET /api/v1/schedule/changelog` - журнал изменений

## Следующие шаги

1. Установить зависимости: `pip install -r requirements.txt`
2. Создать миграции Alembic (если используется)
3. Запустить приложение: `uvicorn app.main:app --reload`
4. Проверить Swagger документацию: `http://localhost:8000/docs`

## Заметки

- Все UUID поля используют тип GUID для совместимости с SQLite
- Старые endpoints (applications, hotels, reports и т.д.) были удалены из router
- При необходимости можно добавить обратно старые endpoints
- Система уведомлений для изменений расписания пока не реализована (требуется дополнительная разработка)

